<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>ÌöåÏõê ÏàòÏ†ï</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link data-th-href="@{/css/info.css}" rel="stylesheet">
    <link data-th-href="@{/css/style.css}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.10.1/sweetalert2.all.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.10.1/sweetalert2.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
</head>

<body>
<div th:replace="~{header :: header}"></div>
<main>

    <div class="wrapper">
        <!-- Í≤ÄÏ¶ù -->
        <div class="alert alert-success" th:if="${message}" th:text="${message}"></div>
        <div class="alert alert-danger" th:if="${error}" th:text="${error}"></div>

        <div th:unless="${user}">
            <p>ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.</p>
        </div>

        <div class="my-info-container" data-th-if="${user}" data-th-object="${user}">
            <form class="profile-form"
                  enctype="multipart/form-data"
                  method="post"
                  onsubmit="return validateForm()"
                  th:action="@{/user/update}">

                <!-- ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ -->
                <div class="profile-img-container">
                    <div class="profile-img-inner-container">
                        <label for="file" style="cursor: pointer; position: relative; display: block;">
                            <img alt="ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ"
                                 class="profile-img"
                                 id="previewImage"
                                 style="width: 400px; height: 400px; object-fit: cover;"
                                 th:src="${user.photo != null} ?
                        'https://qc02pnrw5255.edge.naverncp.com/JjKIB1bIlV/user/profile/' + ${user.photo} + '?type=f&w=400&h=400' :
                        'https://qc02pnrw5255.edge.naverncp.com/JjKIB1bIlV/images/default-profile.png?type=f&w=400&h=400'">
                            <div class="edit-overlay">
                                <i class="fas fa-camera"></i>
                            </div>
                        </label>
                        <input accept="image/*"
                               id="file"
                               name="file"
                               onchange="validateAndPreviewImage(this)"
                               style="display: none;"
                               type="file">
                        <div class="error-message" id="errorMessage" style="color: red; display: none;"></div>
                    </div>
                    <!-- Î≤ÑÌäº Í∑∏Î£π -->
                    <div class="btn-group w-100" role="group">
                        <button class="btn btn-dark" type="submit">Î≥ÄÍ≤ΩÌïòÍ∏∞</button>
                        <button class="btn btn-secondary" onclick="window.location.href='/user/myInfo'"
                                type="button">Ï∑®ÏÜå
                        </button>
                    </div>
                </div>

                <!-- ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ -->
                <div class="my-info-right-container">
                    <input name="no" th:value="*{no}" type="hidden">

                    <div class="my-info-right-container-header">
                        <!-- ÏóÖÏ†Å ÏóÖÎç∞Ïù¥Ìä∏ -->
                        <div class="my-primary-achievement">
                            <!-- ÌòÑÏû¨ ÎåÄÌëúÏóÖÏ†Å ÌëúÏãú -->
                            <div id="achievementDisplay"
                                 style="display: flex; align-items: center; margin-bottom: 1rem;">
                                <div style="display: flex; align-items: center; gap: 1rem;"
                                     th:if="${primaryAchievement}">
                                    <img alt="ÎåÄÌëúÏóÖÏ†Å Ïù¥ÎØ∏ÏßÄ" class="my-primary-achievement-img"
                                         th:src="${'/images/achievement/complete/' + primaryAchievement.photo}">
                                    <span th:text="${primaryAchievement.name}"></span>
                                </div>
                                <div th:unless="${primaryAchievement}">
                                    <span>ÎåÄÌëúÏóÖÏ†ÅÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</span>
                                </div>
                                <button class="myinfo-achievement-editbutton" onclick="showAchievementEdit()"
                                        type="button">üñäÔ∏è
                                </button>
                            </div>

                            <!-- ÏóÖÏ†Å ÏàòÏ†ï ÎìúÎ°≠Îã§Ïö¥ (Í∏∞Î≥∏Ï†ÅÏúºÎ°ú Ïà®ÍπÄ) -->
                            <div class="input-achievement" id="achievementEdit"
                                 style="display: none;">
                                <div class="btn-group w-100">
                                    <button aria-expanded="false"
                                            class="btn btn-outline-secondary dropdown-toggle w-100"
                                            data-bs-toggle="dropdown"
                                            type="button">
                                        <span id="achievement-selected">ÏóÖÏ†ÅÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</span>
                                    </button>
                                    <ul class="dropdown-menu w-100">
                                        <th:block th:if="${not #lists.isEmpty(listGetUserAchievement)}">
                                            <th:block th:each="title : ${listGetUserAchievement}">
                                                <li>
                                                    <a class="dropdown-item"
                                                       href="#"
                                                       onclick="selectAchievement(this)"
                                                       th:data-id="${title.id}"
                                                       th:text="${title.name}">
                                                    </a>
                                                </li>
                                            </th:block>
                                        </th:block>
                                        <th:block th:if="${#lists.isEmpty(listGetUserAchievement)}">
                                            <li><a class="dropdown-item" href="#">ÏóÖÏ†ÅÏù¥ ÏóÜÏäµÎãàÎã§</a></li>
                                        </th:block>
                                    </ul>
                                </div>
                                <input data-th-value="${userAchievementId}"
                                       id="user-achievement"
                                       name="user-achievement"
                                       type="hidden">
                                <button class="btn btn-dark"
                                        onclick="hideAchievementEdit()"
                                        style="position: relative; left: 200px; top: -40px;"
                                        type="button">Ï∑®ÏÜå
                                </button>
                                <!-- <div>
                                    <button class="btn btn-dark"
                                            onclick="hideAchievementEdit()"
                                            style="position: relative; left: 200px; top: -40px;"
                                            type="button">Ï∑®ÏÜå
                                    </button>
                                </div> -->
                            </div>
                        </div>

                        <!-- ÎãâÎÑ§ÏûÑ ÌëúÏãú Î∞è ÏàòÏ†ï ÌïÑÎìú -->
                        <div class="user-nickname">
                            <div class="input-field">
                                <div id="nicknameDisplay" style="display: flex; align-items: center;">
                                    <span th:text="*{nickname}"></span>
                                    <button class="myinfo-nickname-editbutton" onclick="showNicknameEdit()"
                                            type="button">üñäÔ∏è
                                    </button>

                                </div>

                                <div id="nicknameEdit" style="display: none;">
                                    <div style="display: flex; align-items: center;">
                                        <input id="nickname" name="nickname" th:value="*{nickname}" type="text"/>

                                        <div class="btn-group" style="position: relative; left: 10px;">
                                            <button class="btn btn-dark"
                                                    onclick="checkDuplicate('nickname', document.getElementById('nickname').value)"
                                                    type="button">Ï§ëÎ≥µÌôïÏù∏
                                            </button>

                                            <button class="btn btn-secondary"
                                                    onclick="hideNicknameEdit()"
                                                    type="button">Ï∑®ÏÜå
                                            </button>
                                        </div>
                                    </div>

                                </div>
                                <span id="nicknameMessage"></span>
                            </div>
                        </div>
                    </div>

                    <div class="my-info-right-container-body">
                        <div class="my-board-container">
                            <h4 class="text-center" style="margin-bottom: 2rem;">ÌöåÏõê ÏàòÏ†ï</h4>
                            <fieldset disabled>
                                <div class="mb-3">
                                    <label class="form-label" for="disabledTextInput">ÎÇ¥ Ïù¥Î©îÏùº Í≥ÑÏ†ï</label>
                                    <input class="form-control" id="disabledTextInput" placeholder="Disabled input"
                                           th:value="*{email}"
                                           type="text">
                                </div>
                            </fieldset>

                            <div class="mb-3">
                                <label class="form-label" for="password">ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω</label>
                                <div class="input-group">
                                    <input class="form-control"
                                           id="password"
                                           minlength="8"
                                           name="password"
                                           oninput="toggleConfirmPasswordField()"
                                           pattern="^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$"
                                           placeholder="Î≥ÄÍ≤ΩÌïòÏßÄ ÏïäÏúºÎ©¥ Í∏∞Ï°¥ ÎπÑÎ∞ÄÎ≤àÌò∏ Ïú†ÏßÄ"
                                           title="ÏµúÏÜå 8Ïûê, ÏòÅÎ¨∏, Ïà´Ïûê, ÌäπÏàòÎ¨∏ÏûêÎ•º Ìè¨Ìï®Ìï¥Ïïº Ìï©ÎãàÎã§"
                                           type="password">
                                    <span id="passwordMessage"></span>
                                </div>
                            </div>

                            <div class="mb-3" id="confirmPasswordField" style="display: none;">
                                <label class="form-label" for="confirmPassword">ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏</label>
                                <div class="input-group">
                                    <input class="form-control"
                                           id="confirmPassword"
                                           placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏"
                                           type="password">
                                    <span id="confirmPasswordMessage"></span>
                                </div>
                            </div>
                        </div>

                        <div class="my-achievement-container">
                            <!-- SNS Ïó∞Îèô ÏÑπÏÖò -->
                            <div class="input-field sns-connection-section">
                                <div class="sns-connection-title">
                                    <h4 class="text-center" style="margin-bottom: 2rem;">SNS Í≥ÑÏ†ï Ïó∞Îèô</h4>
                                </div>

                                <!-- Google Ïó∞Îèô -->
                                <div class="sns-connection-item">
                                    <button class="btn btn-light w-100 py-2 border"
                                            disabled
                                            style="background-color: #f2f2f2; color: gray; margin-bottom: 30px;"
                                            th:if="${connectedProviders != null && connectedProviders.contains('google')}">
                                        <img alt="Google Icon" class="me-2" src="/images/user/Google.png"
                                             style="width: 20px; height: 20px;">
                                        Google Ïó∞ÎèôÏôÑÎ£å
                                    </button>
                                    <a class="btn btn-light w-100 py-2 border"
                                       href="/oauth2/authorization/google"
                                       style="background-color: #f2f2f2; margin-bottom: 30px;"
                                       th:unless="${connectedProviders != null && connectedProviders.contains('google')}">
                                        <img alt="Google Icon" class="me-2" src="/images/user/Google.png"
                                             style="width: 20px; height: 20px;">
                                        Google Ïó∞ÎèôÌïòÍ∏∞
                                    </a>
                                </div>

                                <!-- Naver Ïó∞Îèô -->
                                <div class="sns-connection-item">
                                    <button class="btn w-100 py-2 text-white"
                                            disabled
                                            style="background-color: #03c75a; color: gray; margin-bottom: 30px;"
                                            th:if="${connectedProviders != null && connectedProviders.contains('naver')}">
                                        <img alt="Naver Icon" class="me-2" src="/images/user/Naver.png"
                                             style="width: 20px; height: 20px;">
                                        Naver Ïó∞ÎèôÏôÑÎ£å
                                    </button>
                                    <a class="btn w-100 py-2 text-white"
                                       href="/oauth2/authorization/naver"
                                       style="background-color: #03c75a; margin-bottom: 30px;"
                                       th:unless="${connectedProviders != null && connectedProviders.contains('naver')}">
                                        <img alt="Naver Icon" class="me-2" src="/images/user/Naver.png"
                                             style="width: 20px; height: 20px;">
                                        Naver Ïó∞ÎèôÌïòÍ∏∞
                                    </a>
                                </div>

                                <!-- Kakao Ïó∞Îèô -->
                                <div class="sns-connection-item">
                                    <button class="btn w-100 py-2"
                                            disabled
                                            style="background-color: #FEE500; color: gray; margin-bottom: 30px;"
                                            th:if="${connectedProviders != null && connectedProviders.contains('kakao')}">
                                        <img alt="Kakao Icon" class="me-2" src="/images/user/KakaoTalk.png"
                                             style="width: 20px; height: 20px;">
                                        Kakao Ïó∞ÎèôÏôÑÎ£å
                                    </button>
                                    <a class="btn w-100 py-2"
                                       href="/oauth2/authorization/kakao"
                                       style="background-color: #FEE500; margin-bottom: 30px;"
                                       th:unless="${connectedProviders != null && connectedProviders.contains('kakao')}">
                                        <img alt="Kakao Icon" class="me-2" src="/images/user/KakaoTalk.png"
                                             style="width: 20px; height: 20px;">
                                        Kakao Ïó∞ÎèôÌïòÍ∏∞
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <div class="withdraw-container">
                <div class="d-grid gap-4 d-md-flex justify-content-md-end mt-4">
                    <form id="withdrawForm" method="post" th:action="@{/user/delete}">
                        <input name="no" th:value="*{no}" type="hidden"/>
                        <button class="myinfo-withdrawbutton btn btn-danger" onclick="confirmWithdraw()"
                                style="margin-right: 18px; margin-left: -135px; margin-top: -60px;"
                                type="button">ÌöåÏõê ÌÉàÌá¥
                        </button>

                    </form>
                </div>
            </div>
        </div>
    </div>
</main>
<script th:src="@{/js/user.js}"></script>
<script th:src="@{/js/achievement.js}"></script>
<div th:replace="~{footer :: footer}"></div>
</body>
</html>
